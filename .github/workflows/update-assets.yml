name: Update assets.json

permissions:
  contents: write

on:
  push:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Generate assets.json
        run: |
          node -e "
          const fs = require('fs');
          const patternsDir = 'patterns';
          const photosDir = 'photos';
          const allowedFileTypes = ['.png', '.jpg', '.jpg'];

          const patternFiles = fs.existsSync(patternsDir) ? fs.readdirSync(patternsDir)
            .filter(f => allowedFileTypes.some(ext => f.toLowerCase().endsWith(ext)))
            .map(f => \`patterns/\${f}\`) : [];

          const photoFiles = fs.existsSync(photosDir) ? fs.readdirSync(photosDir)
            .filter(f => allowedFileTypes.some(ext => f.toLowerCase().endsWith(ext)))
            .map(f => \`photos/\${f}\`) : [];

          const assets = {
            patterns: patternFiles,
            photos: photoFiles,
          };

          fs.writeFileSync('assets.json', JSON.stringify(assets, null, 2));
          "

      - name: Commit and push changes
        run: |
          git config user.name 'uwkx'
          git config user.email 'uk8002@proton.me'
          git add assets.json
          git diff --cached --quiet || git commit -m 'Update assets.json'
          git push origin HEAD:main
